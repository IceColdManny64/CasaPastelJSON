<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Pago - La Casa del Pastel</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --red-700:#a30015;
      --red-500:#d6001c;
      --card-bg:#ffffff;
      --muted:#666;
      --radius:12px;
      --maxwidth:1000px;

      /* Tamaño de miniatura coherente con carrito */
      --thumb-w:120px;
      --thumb-h:90px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: "Segoe UI", system-ui, -apple-system, "Helvetica Neue", Arial;
      background: linear-gradient(rgba(0,0,0,0.38), rgba(0,0,0,0.38)),
        url('https://cdn.pixabay.com/photo/2023/09/04/20/39/cake-8233676_1280.jpg') no-repeat center center/cover;
      color:#111;
      -webkit-font-smoothing:antialiased;
    }
    header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:16px 22px;
      background: rgba(0,0,0,0.45);
      color:white;
      position:sticky;
      top:0;
      z-index:10;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{height:40px;border-radius:6px}
    nav a{color:white;text-decoration:none;margin-left:12px}

    .container{max-width:var(--maxwidth); margin:28px auto; padding:18px;}

    .card{background:var(--card-bg); border-radius:var(--radius); padding:18px; box-shadow:0 12px 30px rgba(0,0,0,0.18)}

    h1{color:var(--red-500); margin:0 0 6px; font-family:'Playfair Display', serif}

    .layout{display:grid; grid-template-columns:1fr 360px; gap:18px; margin-top:14px}
    @media (max-width:980px){ .layout{grid-template-columns:1fr} }

    /* --- Card / item layout (copia estilo carrito) --- */
    .summary .item{
      display:flex;
      gap:16px;
      align-items:flex-start;
      border-radius:10px;
      padding:12px;
      background:#fff7f7;
      border:1px solid rgba(214,0,28,0.05);
      box-shadow: 0 6px 18px rgba(0,0,0,0.05);
    }

    .summary .item img{
      width:var(--thumb-w);
      height:var(--thumb-h);
      object-fit:cover;
      border-radius:8px;
      flex-shrink:0;
      display:block;
      background:#f6f6f6;
    }

    .summary .item-body{flex:1}
    .summary .item-title{font-weight:800; color:var(--red-700); margin-bottom:6px}
    .summary .item-desc{color:var(--muted); margin-bottom:8px}
    .summary .item-price{font-weight:800; margin-bottom:8px; color:var(--red-700)}
    .summary .qty-row{display:flex; align-items:center; gap:8px; margin-top:6px}

    .summary .item-total{font-weight:800; text-align:right; min-width:120px}

    /* contenedor de items con scroll si hay muchos */
    #summaryItems{
      display:flex;
      flex-direction:column;
      gap:12px;
      max-height:420px;
      overflow:auto;
      padding-right:6px;
    }

    .summary .totals{margin-top:12px; font-weight:900; color:var(--red-700)}

    .form-row{display:flex; gap:10px; margin-top:10px}
    .form-field{display:flex; flex-direction:column; margin-bottom:10px}
    input, select, textarea{padding:10px; border-radius:8px; border:1px solid #e6e6e6; font-size:0.95rem}
    textarea{min-height:80px}

    .btn{padding:10px 14px; border-radius:10px; border:0; cursor:pointer; font-weight:800; text-decoration: none;}
    .btn-primary{background:linear-gradient(90deg,var(--red-500),var(--red-700)); color:white}
    .btn-ghost{background:transparent; border:2px solid rgba(0,0,0,0.06); color:var(--red-700)}

    .muted{color:var(--muted)}

    /* responsive: reducir miniatura en pantallas pequeñas */
    @media (max-width:560px){
      :root{ --thumb-w:100px; --thumb-h:78px; }
      #summaryItems{ max-height:520px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <img src="CasaPastel.png" alt="Logo" onerror="this.onerror=null;this.src='CasaPastel-small.png'">
      <div style="font-weight:800">La Casa del Pastel</div>
    </div>
    <nav>
      <a href="menu.html">Menú</a>
      <a href="carritoCompra.html">Carrito</a>
      <a href="seguimiento_pedido.html">Seguimiento</a>
    </nav>
  </header>

  <div class="container">
    <div class="card">
      <h1>Pago y Confirmación</h1>
      <p class="muted">Revisa tu pedido y completa los datos de pago. Al confirmar, serás redirigido a la pantalla de seguimiento.</p>

      <div class="layout">
        <!-- LEFT: formulario de pago -->
        <div class="card" id="leftColumn">
          <h3 style="margin-top:0">Datos de facturación y entrega</h3>

          <div style="margin-top:8px">
            <div class="form-field">
              <label>Nombre</label>
              <input id="payerName" placeholder="Nombre completo">
            </div>
            <div class="form-field">
              <label>Teléfono (WhatsApp)</label>
              <input id="payerPhone" placeholder="Ej. 4491234567">
            </div>
            <div class="form-field">
              <label>Método de pago</label>
              <select id="payMethod">
                <option value="efectivo">Efectivo al recoger/entrega</option>
                <option value="transferencia">Transferencia / Depósito</option>
                <option value="tarjeta">Tarjeta (simulado)</option>
              </select>
            </div>

            <div class="form-field">
              <label>Instrucciones / Dirección</label>
              <textarea id="payerNote" placeholder="Comentarios, dirección o indicaciones"></textarea>
            </div>
          </div>

          <div style="margin-top:8px; display:flex; gap:8px; align-items:center; flex-wrap:wrap">
            <!-- BOTÓN MODIFICADO -->
            <button id="btnPay" class="btn btn-primary">Pagar y Generar pedido</button>
            <a href="carritoCompra.html" class="btn btn-ghost">Volver al carrito</a>
          </div>

          <p class="muted" style="margin-top:10px">Al confirmar, el pedido se registrará y se abrirá el seguimiento.</p>
        </div>

        <!-- RIGHT: resumen del pedido -->
        <aside class="card summary" id="rightColumn">
          <h3 style="margin:0 0 8px">Resumen del pedido</h3>
          <!-- contenedor con scroll si es necesario -->
          <div id="summaryItems" aria-live="polite"></div>
          <div class="totals summaryTotals" id="summaryTotal">Total: $0.00</div>
        </aside>
      </div>
    </div>
  </div>

  <!-- SCRIPT MODIFICADO -->
  <script>
    // helpers
    function loadCart(){
      return JSON.parse(localStorage.getItem('carrito') || '[]');
    }
    function escapeHtml(str){ if(!str) return ''; return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }

    function renderSummary(){
      const cart = loadCart();
      const container = document.getElementById('summaryItems');
      container.innerHTML = '';
      let total = 0;
      if(!cart || cart.length === 0){
        container.innerHTML = '<div class="muted">No hay productos en el carrito.</div>';
        document.getElementById('btnPay').disabled = true;
      } else {
        document.getElementById('btnPay').disabled = false;
        cart.forEach((p, index)=>{
          const qty = Number(p.cantidad) || Number(p.qty) || 1;
          const price = Number(p.precio ?? p.price ?? 0);
          total += price * qty;

          // Crear tarjeta como en el carrito
          const card = document.createElement('div');
          card.className = 'item';

          const img = document.createElement('img');
          img.src = (p.imagen_url || p.img || 'https://via.placeholder.com/300x200');
          img.alt = (p.titulo || p.nombre || 'Producto');
          img.onerror = function(){ this.onerror=null; this.src='https://via.placeholder.com/300x200'; };

          const body = document.createElement('div');
          body.className = 'item-body';
          // Se ha quitado onchange="" del input y se ha puesto readonly
          body.innerHTML = `<div class="item-title">${escapeHtml(p.titulo || p.nombre || 'Producto')}</div>
                            <div class="item-desc">${escapeHtml(p.descripcion || '')}</div>
                            <div class="item-price">Precio unitario: $${price.toFixed(2)}</div>
                            <div class="qty-row"><label style="font-weight:700; color:var(--red-700)">Cant:</label>
                              <input type="number" min="1" value="${qty}" style="width:70px; padding:6px; border-radius:6px; border:1px solid #e6e6e6"
                                readonly>
                              <span style="margin-left:10px; color:var(--muted)">Stock: ${p.stock ?? '—'}</span>
                            </div>`;

          const totalDiv = document.createElement('div');
          totalDiv.className = 'item-total';
          totalDiv.textContent = `$${(price*qty).toFixed(2)}`;

          card.appendChild(img);
          card.appendChild(body);
          card.appendChild(totalDiv);
          container.appendChild(card);
        });
      }
      document.getElementById('summaryTotal').textContent = `Total: $${total.toFixed(2)}`;
    }

    // --- SE HAN ELIMINADO LAS FUNCIONES COMPLEJAS ---
    //- updateQtyFromSummary
    //- generateOrderNumber
    //- createOrderFromCartAndRedirect

    // --- LISTENER MODIFICADO ---
    document.getElementById('btnPay').addEventListener('click', function(){
      // Sin validación, sin guardar. Solo redirige.
      console.log("Simulando pago y redirigiendo a seguimiento.html");
      window.location.href = 'seguimiento.html';
    });

    // render on load
    renderSummary();
  </script>
</body>
</html>

