<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Carrito de Compras - La Casa Del Pastel</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --red-700:#a30015;
      --red-500:#d6001c;
      --card-bg: #ffffff;
      --muted: #666;
      --radius: 12px;
      --maxwidth: 900px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      background: linear-gradient(to right, #d6001c, #f08080);
      color:#111;
    }

    /* Header */
    header{
      background-color: var(--red-700);
      padding: 12px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      color: white;
      gap:12px;
    }
    .logo{display:flex; align-items:center; gap:12px}
    .logo img{height:46px}
    .logo h1{font-size:18px; margin:0; font-weight:800}
    nav.header-nav{display:flex; gap:14px; align-items:center}
    nav.header-nav a{color:white; text-decoration:none; font-weight:700; padding:6px 10px; border-radius:8px}
    nav.header-nav a:hover{background: rgba(255,255,255,0.06)}
    .header-actions{display:flex; gap:12px; align-items:center}

    .cart-indicator{
      background: rgba(255,255,255,0.06);
      padding:6px 10px;
      border-radius:8px;
      font-weight:700;
      display:flex;
      align-items:center;
      gap:8px;
    }

    /* Main card */
    main{
      flex:1;
      width:100%;
      max-width:var(--maxwidth);
      margin:24px auto;
      padding:22px;
      background: var(--card-bg);
      color: #111;
      border-radius: var(--radius);
      box-shadow: 0 12px 40px rgba(0,0,0,0.2);
    }

    h1{ text-align:center; color:var(--red-500); margin-bottom:18px; }

    /* Lista del carrito */
    #carrito-lista{
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .item{
      display:flex;
      gap:16px;
      align-items:flex-start;
      border-radius:10px;
      padding:14px;
      background:#fff7f7;
      border:1px solid rgba(214,0,28,0.05);
      box-shadow: 0 6px 18px rgba(0,0,0,0.05);
    }

    .item img{
      width:120px;
      height:90px;
      object-fit:cover;
      border-radius:8px;
      flex-shrink:0;
    }

    .item-body{flex:1}
    .item-title{font-weight:800; color:var(--red-700); margin-bottom:6px}
    .item-desc{color:var(--muted); margin-bottom:8px}
    .item-price{font-weight:800; margin-bottom:8px}
    .qty-row{display:flex; align-items:center; gap:8px; margin-top:6px}

    input[type="number"]{
      width:70px; padding:6px; border-radius:6px; border:1px solid #e6e6e6;
    }

    .item-total{font-weight:800; text-align:right; min-width:120px}

    /* Acciones */
    .actions{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-top:20px;
    }

    .btn-primary{
      background: linear-gradient(90deg, var(--red-500), var(--red-700));
      color:white; border:none; padding:10px 16px; border-radius:10px; cursor:pointer; font-weight:800;
    }

    #vaciar-carrito{
      background: #a30015; color:white; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:700;
    }

    #vaciar-carrito[hidden]{display:none}

    #carrito-total{
      font-weight:900; color:var(--red-700); font-size:1.05rem;
    }

    #mensaje-vacio{
      text-align:center;
      color:var(--muted);
      padding:40px 10px;
      border-radius:8px;
      background:#fff7f7;
      border:1px dashed rgba(214,0,28,0.07);
      margin:18px 0;
    }

    @media (max-width:720px){
      .item{flex-direction:column; align-items:center}
      .item img{width:90%; height:160px}
      .item-total{text-align:center; width:100%}
      .actions{flex-direction:column; align-items:stretch}
    }
  </style>
</head>
<body>

  <header>
    <div class="logo">
      <img src="LOGO2.png" alt="Logo La Casa Del Pastel">
      <h1>La Casa Del Pastel</h1>
    </div>

    <div class="header-actions">
      <nav class="header-nav" aria-label="principal">
        <a href="menu.html">Cat√°logo</a>
        <a href="pantallaUsuario.html">Perfil</a>
        <a href="ofertas.php">Ofertas</a>
        <a href="contacto.html">Contacto</a>
      </nav>

      <div class="cart-indicator" id="cartIndicator" title="Estado del carrito">
        <!-- Se rellena por JS -->
      </div>
    </div>
  </header>

  <main>
    <h1>Carrito de Compras</h1>

    <!-- Lista generada por JS -->
    <div id="carrito-lista" aria-live="polite"></div>

    <!-- Mensaje de vac√≠o (se mostrar√° si no hay items) -->
    <div id="mensaje-vacio" style="display:none">Tu carrito est√° vac√≠o. Explora el cat√°logo y agrega tus delicias favoritas üç∞</div>

    <div class="actions">
      <button id="vaciar-carrito" onclick="vaciarCarrito()">Vaciar carrito</button>
      <div id="carrito-total">Total: $0.00</div>
      <button class="btn-primary" id="btn-pagar" onclick="irAPago()">Realizar pago</button>
    </div>
  </main>

  <script>
    // Mantengo la funcionalidad existente (lee localStorage 'carrito' con estructura esperada)
    function mostrarCarrito() {
      const carrito = JSON.parse(localStorage.getItem("carrito")) || [];
      const lista = document.getElementById("carrito-lista");
      const totalDiv = document.getElementById("carrito-total");
      const mensajeVacio = document.getElementById("mensaje-vacio");
      const vaciarBtn = document.getElementById("vaciar-carrito");
      const cartIndicator = document.getElementById("cartIndicator");

      lista.innerHTML = "";
      let totalGeneral = 0;

      if (carrito.length === 0) {
        // Mostrar mensaje de carrito vac√≠o
        mensajeVacio.style.display = "block";
        vaciarBtn.hidden = true;
        totalDiv.textContent = "Total: $0.00";
        cartIndicator.textContent = "Carrito vac√≠o";
        return;
      } else {
        mensajeVacio.style.display = "none";
        vaciarBtn.hidden = false;
      }

      carrito.forEach((producto, index) => {
        // soporta campos: imagen_url, titulo, precio, descripcion, cantidad, stock
        const cantidad = Number(producto.cantidad) || 1;
        const unitPrice = Number(producto.precio) || 0;
        const totalPorProducto = (unitPrice * cantidad);
        totalGeneral += totalPorProducto;

        const item = document.createElement("div");
        item.className = "item";
        item.innerHTML = `
          <img src="${producto.imagen_url || producto.img || 'https://via.placeholder.com/150'}" alt="${producto.titulo || producto.nombre || 'Producto'}">
          <div class="item-body">
            <div class="item-title">${producto.titulo || producto.nombre || 'Producto sin nombre'}</div>
            <div class="item-desc">${producto.descripcion || ''}</div>
            <div class="item-price">Precio unitario: $${unitPrice.toFixed(2)}</div>
            <div class="qty-row">
              <label for="cantidad-${index}" style="font-weight:700; color:var(--red-700)">Cantidad:</label>
              <input id="cantidad-${index}" type="number" min="1" value="${cantidad}" onchange="actualizarCantidad(${index}, this.value)">
              <span style="margin-left:10px; color:var(--muted)">Stock: ${producto.stock ?? '‚Äî'}</span>
            </div>
          </div>
          <div class="item-total">
            <div>Total: $${totalPorProducto.toFixed(2)}</div>
          </div>
        `;
        lista.appendChild(item);
      });

      totalDiv.textContent = `Total: $${totalGeneral.toFixed(2)}`;

      // Indicador en header: n√∫mero de items y total
      const count = carrito.reduce((s, p) => s + (Number(p.cantidad) || 0), 0);
      cartIndicator.textContent = `${count} item(s) ‚Ä¢ $${totalGeneral.toFixed(2)}`;
    }

    function actualizarCantidad(index, nuevaCantidad) {
      const carrito = JSON.parse(localStorage.getItem("carrito")) || [];
      nuevaCantidad = parseInt(nuevaCantidad);

      if (isNaN(nuevaCantidad) || nuevaCantidad < 1) {
        alert("La cantidad debe ser al menos 1.");
        mostrarCarrito();
        return;
      }

      const disponible = carrito[index].stock ?? Infinity;

      if (nuevaCantidad > disponible) {
        alert(`Lo sentimos. Solo hay ${disponible} unidades disponibles de "${carrito[index].titulo || carrito[index].nombre}".`);
        mostrarCarrito();
        return;
      }

      carrito[index].cantidad = nuevaCantidad;
      localStorage.setItem("carrito", JSON.stringify(carrito));
      mostrarCarrito(); // recargar vista
    }

    function vaciarCarrito() {
      if (confirm('¬øSeguro que quieres vaciar el carrito?')) {
        localStorage.removeItem('carrito');
        mostrarCarrito();
      }
    }

    function irAPago() {
      // No modifiqu√© tu flujo: redirige a pago.html (puedes cambiar si lo deseas)
      window.location.href = 'pago.html';
    }

    // Inicializar
    mostrarCarrito();
  </script>

</body>
</html>
