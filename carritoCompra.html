<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Carrito de Compras - La Casa Del Pastel</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --red-700:#a30015;
      --red-500:#d6001c;
      --card-bg: #ffffff;
      --muted: #666;
      --radius: 12px;
      --maxwidth: 900px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      height: 100%;
      font-family: 'Playfair Display', serif;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)),
        url('https://cdn.pixabay.com/photo/2023/09/04/20/39/cake-8233676_1280.jpg') no-repeat center center/cover;
      color:#111;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 60px;
      background-color: rgba(0, 0, 0, 0.6);
      z-index: 10;
      position: relative;
    }
    .logo{display:flex; align-items:center; gap:12px; color: white;}
    .logo img{height:46px}
    .logo h1{font-size:18px; margin:0; font-weight:800}
    nav {
      display: flex;
      align-items: center;
      gap: 15px;
    }

        footer.legal-footer {
      background-color: rgba(0, 0, 0, 0.8);
      color: #ccc;
      padding: 25px;
      text-align: center;
      font-size: 0.8em;
      font-family: 'Open Sans', sans-serif;
      z-index: 2;
      width: 100%;
    }

    footer.legal-footer a {
      color: #f4a261;
      text-decoration: none;
      margin: 0 10px;
    }

    footer.legal-footer a:hover {
      text-decoration: underline;
    }

    footer.legal-footer p {
      margin: 0;
      padding: 5px 0;
    }

    footer.legal-footer .credits {
      margin-top: 10px;
      opacity: 0.7;
    }

    nav a {
      text-decoration: none;
      color: white;
      font-size: 1em;
    }

    .cart-indicator{
      background: rgba(255,255,255,0.06);
      padding:6px 10px;
      border-radius:8px;
      font-weight:700;
      display:flex;
      align-items:center;
      gap:8px;
      color: white;
    }

    /* Main card */
    main{
      flex:1;
      width:100%;
      max-width:var(--maxwidth);
      margin:24px auto;
      padding:22px;
      background: var(--card-bg);
      color: #111;
      border-radius: var(--radius);
      box-shadow: 0 12px 40px rgba(0,0,0,0.2);
    }

        /* --- Estilo para submenu --- */
    .submenu {
      position: relative;
    }

    .submenu > a {
      cursor: pointer;
    }

    .submenu-content {
      display: none;
      position: absolute;
      top: 100%; /* debajo del bot√≥n */
      left: 0;
      background-color: rgba(0, 0, 0, 0.9);
      min-width: 220px;
      border-radius: 5px;
      z-index: 999;
    }

    .submenu-content a {
      color: white;
      padding: 10px 15px;
      display: block;
      text-decoration: none;
      white-space: nowrap;
    }

    .submenu-content a:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    /* Mantener abierto mientras est√© en hover el contenedor */
    .submenu:hover .submenu-content {
      display: block;
    }

    h1{ text-align:center; color:var(--red-500); margin-bottom:18px; }

    /* Lista del carrito */
    #carrito-lista{
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .item{
      display:flex;
      gap:16px;
      align-items:flex-start;
      border-radius:10px;
      padding:14px;
      background:#fff7f7;
      border:1px solid rgba(214,0,28,0.05);
      box-shadow: 0 6px 18px rgba(0,0,0,0.05);
    }

    .item img{
      width:120px;
      height:90px;
      object-fit:cover;
      border-radius:8px;
      flex-shrink:0;
    }

    .item-body{flex:1}
    .item-title{font-weight:800; color:var(--red-700); margin-bottom:6px}
    .item-desc{color:var(--muted); margin-bottom:8px}
    .item-price{font-weight:800; margin-bottom:8px}
    .qty-row{display:flex; align-items:center; gap:8px; margin-top:6px}

    input[type="number"]{
      width:70px; padding:6px; border-radius:6px; border:1px solid #e6e6e6;
    }

    .item-total{font-weight:800; text-align:right; min-width:120px}

    /* Acciones */
    .actions{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-top:20px;
    }

    .btn-primary{
      background: linear-gradient(90deg, var(--red-500), var(--red-700));
      color:white; border:none; padding:10px 16px; border-radius:10px; cursor:pointer; font-weight:800;
    }

    #vaciar-carrito{
      background: #a30015; color:white; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:700;
    }

    #vaciar-carrito[hidden]{display:none}

    #carrito-total{
      font-weight:900; color:var(--red-700); font-size:1.05rem;
    }

    #mensaje-vacio{
      text-align:center;
      color:var(--muted);
      padding:40px 10px;
      border-radius:8px;
      background:#fff7f7;
      border:1px dashed rgba(214,0,28,0.07);
      margin:18px 0;
    }

    @media (max-width:720px){
      .item{flex-direction:column; align-items:center}
      .item img{width:90%; height:160px}
      .item-total{text-align:center; width:100%}
      .actions{flex-direction:column; align-items:stretch}
    }

    /* --- MODAL PERSONALIZADO (CSS) --- */
    .custom-modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6); z-index: 3000;
      display: none; justify-content: center; align-items: center;
      backdrop-filter: blur(4px); opacity: 0; transition: opacity 0.3s ease;
    }
    .custom-modal-overlay.open { display: flex; opacity: 1; }
    .custom-modal-box {
      background: white; padding: 30px; border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      max-width: 420px; width: 90%; text-align: center;
      /* Usamos la fuente del sitio */
      font-family: 'Playfair Display', serif;
      transform: translateY(20px); transition: transform 0.3s ease;
    }
    .custom-modal-overlay.open .custom-modal-box { transform: translateY(0); }
    .custom-modal-icon { font-size: 3rem; margin-bottom: 15px; display: block; }
    .custom-modal-title { font-size: 1.4rem; font-weight: 700; margin-bottom: 10px; color: var(--red-700); }
    /* Mensaje con fuente sans-serif para legibilidad */
    .custom-modal-msg { 
      font-size: 1rem; margin-bottom: 25px; color: #555; line-height: 1.5; 
      font-family: system-ui, -apple-system, sans-serif; 
    }
    .custom-modal-actions { display: flex; justify-content: center; gap: 10px; }
    .custom-btn {
      padding: 12px 24px; border: none; border-radius: 8px;
      font-weight: 600; cursor: pointer; transition: all 0.2s; font-size: 0.95rem;
      font-family: sans-serif;
    }
    .btn-modal-confirm { background: linear-gradient(135deg, var(--red-500), var(--red-700)); color: white; box-shadow: 0 4px 10px rgba(214,0,28,0.3); }
    .btn-modal-confirm:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(214,0,28,0.4); }
    .btn-modal-cancel { background: #f0f0f0; color: #333; }
    .btn-modal-cancel:hover { background: #e0e0e0; }
  </style>
</head>
<body>

  <header>
    <div class="logo">
      <img src="CasaPastel.png" alt="Logo" onerror="this.onerror=null;this.src='https://placehold.co/50x50?text=CP'">
      <h1>La Casa Del Pastel</h1>
    </div>


    <nav>
      <a href="menu.html">Men√∫</a>
      <a href="conocenos.html">Con√≥cenos</a>
      <a href="ofertas.php">Ofertas</a>
      <a href="contacto.html">Contacto</a>
      <a href="seguimiento.html">Seguimiento</a>

      <!-- Nuevo men√∫ para documentos -->
      <div class="submenu">
        <a>Proyecto ‚ñº</a>
        <div class="submenu-content">
          <a href="infraestructura.html">Justificaci√≥n de Recursos</a>
          <a href="ind.html">Plataformas abiertas/cerradas</a>
          <a href="status.html">Estado de servicio/recursos</a>
        </div>
      </div>
    </nav>

      <div class="cart-indicator" id="cartIndicator" title="Estado del carrito">
        <!-- Se rellena por JS -->
      </div>
    </div>
  </header>

  <main>
    <h1>Carrito de Compras</h1>

    <!-- Lista generada por JS -->
    <div id="carrito-lista" aria-live="polite"></div>

    <!-- Mensaje de vac√≠o (se mostrar√° si no hay items) -->
    <div id="mensaje-vacio" style="display:none">Tu carrito est√° vac√≠o. Explora el cat√°logo y agrega tus delicias favoritas üç∞</div>

    <div class="actions">
      <button id="vaciar-carrito" onclick="vaciarCarrito()">Vaciar carrito</button>
      <div id="carrito-total">Total: $0.00</div>
      <button class="btn-primary" id="btn-pagar" onclick="irAPago()">Realizar pago</button>
            
    </div>
  </main>

  <!-- Modal Personalizado (HTML) -->
  <div id="custom-modal-overlay" class="custom-modal-overlay">
    <div class="custom-modal-box">
      <span id="custom-modal-icon" class="custom-modal-icon"></span>
      <div id="custom-modal-title" class="custom-modal-title"></div>
      <div id="custom-modal-msg" class="custom-modal-msg"></div>
      <div id="custom-modal-actions" class="custom-modal-actions"></div>
    </div>
  </div>

  <script>
    // --- LOGICA DE MODALES ---
    function closeCustomModal() {
      const overlay = document.getElementById('custom-modal-overlay');
      overlay.classList.remove('open');
      setTimeout(() => { overlay.style.display = 'none'; }, 300);
    }

    function showNotification(message, title = "Aviso", type = "info") {
      return new Promise(resolve => {
        const overlay = document.getElementById('custom-modal-overlay');
        const icon = document.getElementById('custom-modal-icon');
        const titleEl = document.getElementById('custom-modal-title');
        const msgEl = document.getElementById('custom-modal-msg');
        const actions = document.getElementById('custom-modal-actions');

        overlay.style.display = 'flex';
        void overlay.offsetWidth; // Forzar reflow
        overlay.classList.add('open');

        titleEl.textContent = title;
        msgEl.innerHTML = message.replace(/\n/g, '<br>');
        
        if (type === 'error') {
          icon.innerHTML = '‚ùå'; 
          titleEl.style.color = '#d32f2f';
        } else if (type === 'success') {
          icon.innerHTML = '‚úÖ';
          titleEl.style.color = '#2e7d32';
        } else {
          icon.innerHTML = '‚ÑπÔ∏è';
          titleEl.style.color = '#a30015';
        }

        actions.innerHTML = `<button class="custom-btn btn-modal-confirm" id="btn-modal-ok">Entendido</button>`;
        
        document.getElementById('btn-modal-ok').onclick = () => {
          closeCustomModal();
          resolve();
        };
      });
    }

    function showConfirmation(message, title = "Confirmaci√≥n") {
      return new Promise(resolve => {
        const overlay = document.getElementById('custom-modal-overlay');
        const icon = document.getElementById('custom-modal-icon');
        const titleEl = document.getElementById('custom-modal-title');
        const msgEl = document.getElementById('custom-modal-msg');
        const actions = document.getElementById('custom-modal-actions');

        overlay.style.display = 'flex';
        void overlay.offsetWidth;
        overlay.classList.add('open');

        icon.innerHTML = '‚ùì';
        titleEl.textContent = title;
        titleEl.style.color = '#a30015';
        msgEl.innerHTML = message;

        actions.innerHTML = `
          <button class="custom-btn btn-modal-cancel" id="btn-modal-cancel">Cancelar</button>
          <button class="custom-btn btn-modal-confirm" id="btn-modal-yes">S√≠, confirmar</button>
        `;

        document.getElementById('btn-modal-yes').onclick = () => {
          closeCustomModal();
          resolve(true);
        };
        document.getElementById('btn-modal-cancel').onclick = () => {
          closeCustomModal();
          resolve(false);
        };
      });
    }

    // --- LOGICA DEL CARRITO ---
    function mostrarCarrito() {
      const carrito = JSON.parse(localStorage.getItem("carrito")) || [];
      const lista = document.getElementById("carrito-lista");
      const totalDiv = document.getElementById("carrito-total");
      const mensajeVacio = document.getElementById("mensaje-vacio");
      const vaciarBtn = document.getElementById("vaciar-carrito");
      const cartIndicator = document.getElementById("cartIndicator");

      lista.innerHTML = "";
      let totalGeneral = 0;

      if (carrito.length === 0) {
        mensajeVacio.style.display = "block";
        vaciarBtn.hidden = true;
        totalDiv.textContent = "Total: $0.00";
        cartIndicator.textContent = "Carrito vac√≠o";
        return;
      } else {
        mensajeVacio.style.display = "none";
        vaciarBtn.hidden = false;
      }

      carrito.forEach((producto, index) => {
        const cantidad = Number(producto.cantidad) || 1;
        const unitPrice = Number(producto.precio) || 0;
        const totalPorProducto = (unitPrice * cantidad);
        totalGeneral += totalPorProducto;

        const item = document.createElement("div");
        item.className = "item";
        item.innerHTML = `
          <img src="${producto.imagen_url || producto.img || 'https://via.placeholder.com/150'}" alt="${producto.titulo || producto.nombre || 'Producto'}">
          <div class="item-body">
            <div class="item-title">${producto.titulo || producto.nombre || 'Producto sin nombre'}</div>
            <div class="item-desc">${producto.descripcion || ''}</div>
            <div class="item-price">Precio unitario: $${unitPrice.toFixed(2)}</div>
            <div class="qty-row">
              <label for="cantidad-${index}" style="font-weight:700; color:var(--red-700)">Cantidad:</label>
              <input id="cantidad-${index}" type="number" min="1" value="${cantidad}" onchange="actualizarCantidad(${index}, this.value)">
              <span style="margin-left:10px; color:var(--muted)">Stock: ${producto.stock ?? '‚Äî'}</span>
            </div>
          </div>
          <div class="item-total">
            <div>Total: $${totalPorProducto.toFixed(2)}</div>
          </div>
        `;
        lista.appendChild(item);
      });

      totalDiv.textContent = `Total: $${totalGeneral.toFixed(2)}`;
      const count = carrito.reduce((s, p) => s + (Number(p.cantidad) || 0), 0);
      cartIndicator.textContent = `${count} item(s) ‚Ä¢ $${totalGeneral.toFixed(2)}`;
    }

    // ACTUALIZACI√ìN: Uso de showNotification en lugar de alert
    function actualizarCantidad(index, nuevaCantidad) {
      const carrito = JSON.parse(localStorage.getItem("carrito")) || [];
      nuevaCantidad = parseInt(nuevaCantidad);

      if (isNaN(nuevaCantidad) || nuevaCantidad < 1) {
        showNotification("La cantidad debe ser al menos 1.", "Cantidad Inv√°lida", "error");
        mostrarCarrito(); // Restaurar valor visual
        return;
      }

      const disponible = carrito[index].stock ?? Infinity;

      if (nuevaCantidad > disponible) {
        showNotification(`Lo sentimos. Solo hay ${disponible} unidades disponibles.`, "Stock Insuficiente", "error");
        mostrarCarrito(); // Restaurar valor visual
        return;
      }

      carrito[index].cantidad = nuevaCantidad;
      localStorage.setItem("carrito", JSON.stringify(carrito));
      mostrarCarrito();
    }

    // ACTUALIZACI√ìN: Uso de showConfirmation as√≠ncrono
    async function vaciarCarrito() {
      const confirmado = await showConfirmation('¬øSeguro que quieres vaciar todo el carrito? No podr√°s deshacer esta acci√≥n.', 'Vaciar Carrito');
      
      if (confirmado) {
        localStorage.removeItem('carrito');
        mostrarCarrito();
        showNotification("El carrito se ha vaciado correctamente.", "Carrito Vac√≠o", "success");
      }
    }

    function irAPago() {
      window.location.href = 'pago.html';
    }

    // Inicializar
    mostrarCarrito();
  </script>

    <!-- INICIO: PIE DE P√ÅGINA LEGAL Y CR√âDITOS -->
  <footer class="legal-footer">
    <p>
      <a href="legales.html#terminos">T√©rminos y Condiciones</a> |
      <a href="legales.html#privacidad">Aviso de Privacidad</a> |
      <a href="legales.html#devoluciones">Pol√≠ticas de Devoluci√≥n</a>
    </p>
    <p class="credits">
      Cr√©ditos de imagen: Todas las fotograf√≠as utilizadas en este sitio (incluyendo el fondo) fueron obtenidas de <a href="https://pixabay.com" target="_blank">Pixabay</a> bajo licencia de uso libre.
    </p>
    <p>¬© 2025 La Casa del Pastel. Todos los derechos reservados.</p>
  </footer>
  <!-- FIN: PIE DE P√ÅGINA -->

</body>
</html>